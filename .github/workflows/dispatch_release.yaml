name: "[Dispatch] Release"

on:
  workflow_dispatch:
    inputs:
      branch:
        description: 'branch를 입력해주세요(master와 release-x.y.z만 허용)'
        required: true
        default: 'master'
      version:
        description: 'version을 입력해주세요(x.y.z)'
        required: true
        default: '1.0.0'

env:
  BRANCH: ${{ github.event.inputs.branch }}
  VERSION: ${{ github.event.inputs.version }}
#  SLACK_WEBHOOK_URL: ${{secrets.SLACK_WEBHOOK_URL}}

jobs:
  build_and_push:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        with:
          ref: ${{ env.BRANCH }}
          token: ${{ secrets.PAT_TOKEN }}

#      - name: Set python
#        uses: actions/setup-python@v4
#        with:
#          python-version: '3.8'
#
#      - name: Install dependencies
#        run: |
#            python -m pip install --upgrade pip
#            pip install setuptools wheel twine
#
#      - name: Make all and Packaging
#        run: |
#          make python
#          sudo chmod -R 777 dist
#          cd dist/python
#
#      - name: Make all and Packaging
#        run: |
#          make json
#          sudo chmod -R 777 dist

#      - name: Publish a Python distribution to PyPI
#        uses: pypa/gh-action-pypi-publish@release/v1
#        with:
#          user: ${{ secrets.PYPI_USERNAME }}
#          password: ${{ secrets.PYPI_API_TOKEN }}
#          verbose: true
#          packages-dir: dist/python/

#      - name: Push artifacts to origin master
#        uses: stefanzweifel/git-auto-commit-action@v4
#        with:
#          branch: test/git-action-build
#          commit_message: "[CI] api has been built"
#          commit_user_name: ImmMin5
#          commit_user_email: iam.minhokim@gmail.com
#          commit_author: ImMin5 <mino@megazone.com>
#          push_options: '--force'
#          tagging_message: ${{ env.VERSION }}

      - name: Push json to api-doc repository
        uses: andstor/copycat-action@v3
        with:
          personal_token: ${{ secrets.PAT_TOKEN }}
          src_path: dist/.
          src_branch: test/git-action-build
          dst_branch: test/gitaction
          dst_path: /.
          dst_owner: ImMin5
          dst_repo_name: api-doc

#      - name: Notice when job fails
#        if: failure()
#        uses: 8398a7/action-slack@v3.15.0
#        with:
#          status: ${{job.status}}
#          fields: repo,workflow,job
#          author_name: Github Action Slack

#  notification:
#    needs: tagging
#    runs-on: ubuntu-latest
#    steps:
#      - name: Slack
#        if: always()
#        uses: 8398a7/action-slack@v3.15.0
#        with:
#          status: ${{job.status}}
#          fields: repo,message,commit,author,action,ref,workflow,job
#          author_name: Github Action Slack